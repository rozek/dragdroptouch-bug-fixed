{"version":3,"file":"DragDropTouch.js","sources":["../src/DragDropTouch.ts"],"sourcesContent":["let DragDropTouch:any\n(function (DragDropTouchExport) {\n  type DropEffect    = 'none'|'copy'|'link'|'move'\n  type allowedEffect = (\n    'none'|'copy'|'copyLink'|'copyMove'|'link'|'linkMove'|'move'|'all'|'uninitialized'\n  )\n\n  type simulatedDataTransfer = {\n    _dropEffect:DropEffect,\n    _effectAllowed:allowedEffect\n    _data:{ [MIMEType:string]:any }\n  }\n\n  let DataTransfer = (function ():any {\n    function DataTransfer (this:simulatedDataTransfer) {\n      this._dropEffect = 'move'\n      this._effectAllowed = 'all'\n      this._data = {}\n    }\n\n    Object.defineProperty(DataTransfer.prototype, \"dropEffect\", {\n      enumerable:true, configurable:true,\n      get: function ()                 { return this._dropEffect },\n      set: function (value:DropEffect) { this._dropEffect = value },\n    })\n\n    Object.defineProperty(DataTransfer.prototype, \"effectAllowed\", {\n      enumerable:true, configurable:true,\n      get: function ()                    { return this._effectAllowed },\n      set: function (value:allowedEffect) { this._effectAllowed = value },\n    })\n\n    Object.defineProperty(DataTransfer.prototype, \"types\", {\n      enumerable:true, configurable:true,\n      get: function () { return Object.keys(this._data) },\n    })\n\n    DataTransfer.prototype.clearData = function (type:string):void {\n      if (type == null) {\n        this._data = {}\n      } else {\n        delete this._data[type.toLowerCase()]\n      }\n    }\n\n    DataTransfer.prototype.getData = function (type:string):any {\n      return this._data[type.toLowerCase()] || ''\n    }\n\n    DataTransfer.prototype.setData = function (type:string, value:string):void {\n      this._data[type.toLowerCase()] = value\n    }\n\n    DataTransfer.prototype.setDragImage = function (\n      img:Element, offsetX:number,offsetY:number\n    ) {\n      let ddt = DragDropTouchSingleton._instance\n      ddt._imgCustom = img\n      ddt._imgOffset = { x:offsetX, y:offsetY }\n    }\n\n    return DataTransfer\n  }())\n\n  DragDropTouchExport.DataTransfer = DataTransfer\n\n  type DragDropTouchInstance = {\n    _instance:DragDropTouchInstance,\n    getInstance: () => DragDropTouchInstance,\n\n    _lastClick:number,\n    _touchstart:(e:Event) => any,\n    _touchmove:(e:Event) => any,\n    _touchend:(e:Event) => any,\n\n    _imgCustom:Element,\n    _imgOffset: { x:number, y:number },\n\n    _THRESHOLD:number,\n    _OPACITY:number,\n    _DBLCLICK:number,\n    _CTXMENU:number,\n    _ISPRESSHOLDMODE:boolean,\n    _PRESSHOLDAWAIT:number,\n    _PRESSHOLDMARGIN:number,\n    _PRESSHOLDTHRESHOLD:number,\n\n    _rmvAtts:string[],\n    _kbdProps:string[],\n    _ptProps:string[],\n  }\n\n  let DragDropTouchSingleton:DragDropTouchInstance = (function () {\n    function DragDropTouch (this:DragDropTouchInstance) {\n      this._lastClick = 0\n\n      if (\n        (DragDropTouchSingleton != null) &&\n        (DragDropTouchSingleton._instance != null)\n      ) {\n        throw new Error('DragDropTouch instance already created.')\n      }\n\n      // https://github.com/Modernizr/Modernizr/issues/1894\n      let supportsPassive:boolean = false\n      document.addEventListener('test', function () {}, {\n        get passive() { supportsPassive = true; return true }\n      })\n\n      if (navigator.maxTouchPoints > 0) {\n        let touchstart = this._touchstart.bind(this)\n        let touchmove  = this._touchmove.bind(this)\n        let touchend   = this._touchend.bind(this)\n\n        let Options = (\n          supportsPassive ? { passive:false, capture:false } : false\n        )\n\n        document.addEventListener('touchstart',  touchstart, Options)\n        document.addEventListener('touchmove',   touchmove,  Options)\n        document.addEventListener('touchend',    touchend)\n        document.addEventListener('touchcancel', touchend)\n      }\n    }\n\n    DragDropTouch.getInstance = function ():DragDropTouchInstance {\n      return DragDropTouchSingleton._instance\n    }\n\n  /**** Event Handlers ****/\n\n    DragDropTouch.prototype._touchstart = function (e:Event) {\n      let _this = this\n      if (this._shouldHandle(e)) {\n        if (Date.now() - this._lastClick < DragDropTouchSingleton._DBLCLICK) {\n          if (this._dispatchEvent(e, 'dblclick', e.target)) {\n            e.preventDefault()\n            this._reset()\n            return\n          }\n        }\n\n        this._reset()\n\n        let src = this._closestDraggable(e.target)\n        if (src != null) {\n          if (\n            ! this._dispatchEvent(e, 'mousemove', e.target) &&\n            ! this._dispatchEvent(e, 'mousedown', e.target)\n          ) {\n            this._dragSource = src\n            this._ptDown     = this._getPoint(e)\n            this._lastTouch  = e\n            e.preventDefault()\n\n            setTimeout(function () {\n              if ((_this._dragSource === src) && (_this._img == null)) {\n                if (_this._dispatchEvent(e, 'contextmenu', src)) {\n                  _this._reset()\n                }\n              }\n            }, DragDropTouchSingleton._CTXMENU)\n\n            if (DragDropTouchSingleton._ISPRESSHOLDMODE) {\n              this._pressHoldInterval = setTimeout(function () {\n                _this._isDragEnabled = true\n                _this._touchmove(e)\n              }, DragDropTouchSingleton._PRESSHOLDAWAIT)\n            }\n          }\n        }\n      }\n    }\n\n    DragDropTouch.prototype._touchmove = function (e:Event) {\n      if (this._shouldCancelPressHoldMove(e)) {\n        this._reset()\n        return\n      }\n\n      if (this._shouldHandleMove(e) || this._shouldHandlePressHoldMove(e)) {\n        let target = this._getTarget(e)\n        if (this._dispatchEvent(e, 'mousemove', target)) {\n          this._lastTouch = e\n          e.preventDefault()\n          return\n        }\n\n        let lastPointOnPage = this._getPoint(this._lastTouch,true)\n        let curPointOnPage  = this._getPoint(e,true)\n          this._lastMovementX = curPointOnPage.x - lastPointOnPage.x\n          this._lastMovementY = curPointOnPage.y - lastPointOnPage.y\n        let Extras = { movementX:this._lastMovementX, movementY:this._lastMovementY }\n\n        if (this._dragSource && (this._img == null) && this._shouldStartDragging(e)) {\n          this._dispatchEvent(e, 'dragstart', this._dragSource, Extras)\n          this._createImage(e)\n          this._dispatchEvent(e, 'dragenter', target, Extras)\n        }\n\n        if (this._img != null) {\n          this._lastTouch = e\n          e.preventDefault()\n\n          this._dispatchEvent(e, 'drag', this._dragSource, Extras)\n\n          if (target != this._lastTarget) {\n            this._dispatchEvent(this._lastTouch, 'dragleave', this._lastTarget, Extras)\n            this._dispatchEvent(e, 'dragenter', target, Extras)\n            this._lastTarget = target\n          }\n\n          this._moveImage(e)\n          this._isDropZone = this._dispatchEvent(e, 'dragover', target, Extras)\n        }\n      }\n    }\n\n    DragDropTouch.prototype._touchend = function (e:Event) {\n      if (this._shouldHandle(e)) {\n        if (this._dispatchEvent(this._lastTouch, 'mouseup', e.target)) {\n          e.preventDefault()\n          return\n        }\n\n        if (this._img == null) {\n          this._dragSource = null\n          this._dispatchEvent(this._lastTouch, 'click', e.target)\n          this._lastClick = Date.now()\n        }\n\n        this._destroyImage()\n        if (this._dragSource) {\n          let Extras = { movementX:this._lastMovementX, movementY:this._lastMovementY }\n\n          if (e.type.indexOf('cancel') < 0 && this._isDropZone) {\n            this._dispatchEvent(this._lastTouch, 'drop', this._lastTarget, Extras)\n          }\n          this._dispatchEvent(this._lastTouch, 'dragend', this._dragSource, Extras)\n          this._reset()\n        }\n      }\n    }\n\n  /**** Utility Functions ****/\n\n    DragDropTouch.prototype._shouldHandle = function (e:Event):boolean {\n      return (\n        (e != null) && ! e.defaultPrevented &&\n        ((e as TouchEvent).touches != null) && ((e as TouchEvent).touches.length < 2)\n      )\n    }\n\n    DragDropTouch.prototype._shouldHandleMove = function (e:Event):boolean {\n      return ! DragDropTouchSingleton._ISPRESSHOLDMODE && this._shouldHandle(e)\n    }\n\n    DragDropTouch.prototype._shouldHandlePressHoldMove = function (e:Event):boolean {\n      return (\n        DragDropTouchSingleton._ISPRESSHOLDMODE && this._isDragEnabled &&\n        (e != null) && ((e as TouchEvent).touches != null) && ((e as TouchEvent).touches.length > 0)\n      )\n    }\n\n    DragDropTouch.prototype._shouldCancelPressHoldMove = function (e:Event):boolean {\n      return (\n        DragDropTouchSingleton._ISPRESSHOLDMODE && ! this._isDragEnabled &&\n        (this._getDelta(e) > DragDropTouchSingleton._PRESSHOLDMARGIN)\n      )\n    }\n\n    DragDropTouch.prototype._shouldStartDragging = function (e:Event):boolean {\n      let delta = this._getDelta(e)\n      return (\n        (delta > DragDropTouchSingleton._THRESHOLD) ||\n        DragDropTouchSingleton._ISPRESSHOLDMODE && (delta >= DragDropTouchSingleton._PRESSHOLDTHRESHOLD)\n      )\n    }\n\n    DragDropTouch.prototype._reset = function ():void {\n      this._destroyImage()\n      this._dragSource = null\n      this._lastTouch  = null\n      this._lastTarget = null\n      this._ptDown = null\n      this._isDragEnabled = false\n      this._isDropZone = false\n      this._dataTransfer = new DataTransfer()\n      this._lastMovementX = 0\n      this._lastMovementY = 0\n      clearInterval(this._pressHoldInterval)\n    }\n\n    DragDropTouch.prototype._getPoint = function (e:MouseEvent|TouchEvent, page:boolean):any {\n      if (\n        (e != null) && ((e as TouchEvent).touches != null) &&\n        ((e as TouchEvent).touches.length > 0)\n      ) {\n        let Touch = (e as TouchEvent).touches[0]\n        return { x: page ? Touch.pageX : Touch.clientX, y: page ? Touch.pageY : Touch.clientY }\n      } else {\n        let Event = e as MouseEvent\n        return { x: page ? Event.pageX : Event.clientX, y: page ? Event.pageY : Event.clientY }\n      }\n    }\n\n    DragDropTouch.prototype._getDelta = function (e:Event) {\n      if (DragDropTouchSingleton._ISPRESSHOLDMODE && ! this._ptDown) { return 0 }\n      let p = this._getPoint(e)\n      return Math.abs(p.x - this._ptDown.x) + Math.abs(p.y - this._ptDown.y)\n    }\n\n    DragDropTouch.prototype._getTarget = function (e:Event) {\n      let pt = this._getPoint(e)\n      let el = document.elementFromPoint(pt.x, pt.y)\n\n      while ((el != null) && (getComputedStyle(el).pointerEvents == 'none')) {\n        el = el.parentElement\n      }\n      return el\n    }\n\n    DragDropTouch.prototype._createImage = function (e:Event):void {\n      if (this._img != null) { this._destroyImage() }\n\n      let src = this._imgCustom || this._dragSource\n      this._img = src.cloneNode(true)\n      this._copyStyle(src, this._img)\n      this._img.style.top = this._img.style.left = '-9999px'\n\n      if (this._imgCustom == null) {\n        let rc = src.getBoundingClientRect()\n        let pt = this._getPoint(e)\n\n        this._imgOffset = { x: pt.x - rc.left, y: pt.y - rc.top }\n        this._img.style.opacity = DragDropTouchSingleton._OPACITY.toString()\n      }\n\n      this._moveImage(e)\n      document.body.appendChild(this._img)\n    }\n\n    DragDropTouch.prototype._destroyImage = function ():void {\n      if ((this._img != null) && (this._img.parentElement != null)) {\n        this._img.parentElement.removeChild(this._img)\n      }\n      this._img = null\n      this._imgCustom = null\n    }\n\n    DragDropTouch.prototype._moveImage = function (e:Event) {\n      let _this = this\n      requestAnimationFrame(function () {\n        if (_this._img != null) {\n          let pt = _this._getPoint(e, true), s = _this._img.style\n          s.position = 'absolute'\n          s.pointerEvents = 'none'\n          s.zIndex = '999999'\n          s.left = Math.round(pt.x - _this._imgOffset.x) + 'px'\n          s.top = Math.round(pt.y - _this._imgOffset.y) + 'px'\n        }\n      })\n    }\n\n    DragDropTouch.prototype._copyProps = function (\n      dst:any, src:any, props:string[]\n    ):void {\n      for (let i = 0; i < props.length; i++) {\n        let p = props[i]\n        dst[p] = src[p]\n      }\n    }\n\n    DragDropTouch.prototype._copyStyle = function (src:any, dst:any):void {\n      DragDropTouchSingleton._rmvAtts.forEach(function (att:string) {\n        dst.removeAttribute(att)\n      })\n\n      if (src instanceof HTMLCanvasElement) {\n        let cSrc = src, cDst = dst\n        cDst.width = cSrc.width\n        cDst.height = cSrc.height\n        cDst.getContext('2d').drawImage(cSrc, 0, 0)\n      }\n\n      let cs = getComputedStyle(src) as any // poor trick to satisfy compiler\n      for (let i = 0; i < cs.length; i++) {\n        let key = cs[i]\n        if (key.indexOf('transition') < 0) {\n          dst.style[key] = cs[key]\n        }\n      }\n      dst.style.pointerEvents = 'none'\n\n      for (let i = 0; i < src.children.length; i++) {\n        this._copyStyle(src.children[i], dst.children[i])\n      }\n    }\n\n    DragDropTouch.prototype._dispatchEvent = function (\n      e:any /* poor TypeScript trick */, type:string, target:Element,\n      Extras?:{ movementX:number, movementY:number }\n    ):boolean {\n      if ((e != null) && (target != null)) {\n        let evt = document.createEvent('Event') as any // poor trick to satisfy compiler\n        let t = (e['touches'] != null) ? e['touches'][0] : e\n          evt.initEvent(type, true, true)\n          evt['button'] = 0\n          evt['which'] = evt['buttons'] = 1\n          this._copyProps(evt, e, DragDropTouchSingleton._kbdProps)\n          this._copyProps(evt, t, DragDropTouchSingleton._ptProps)\n          evt['dataTransfer'] = this._dataTransfer\n\n          if (Extras != null) {\n            evt['movementX'] = Extras.movementX\n            evt['movementY'] = Extras.movementY\n          }\n        target.dispatchEvent(evt)\n        return evt.defaultPrevented\n      }\n      return false\n    }\n\n    DragDropTouch.prototype._closestDraggable = function (e:Element|null) {\n      for (; e; e = e.parentElement) {\n        if (e.hasAttribute('draggable') && e.getAttribute('draggable')) {\n          return e\n        }\n      }\n      return null\n    }\n\n// @ts-ignore\n    let Singleton = new DragDropTouch()\n      Singleton._instance = Singleton\n    return Singleton\n  }())\n\n  DragDropTouchExport.DragDropTouch = DragDropTouchSingleton\n\n  let Singleton = DragDropTouch.DragDropTouch\n\n  Singleton._THRESHOLD = 5; // pixels to move before drag starts\n  Singleton._OPACITY = 0.5; // drag image opacity\n  Singleton._DBLCLICK = 500; // max ms between clicks in a double click\n  Singleton._CTXMENU = 900; // ms to hold before raising 'contextmenu' event\n  Singleton._ISPRESSHOLDMODE = false; // decides of press & hold mode presence\n  Singleton._PRESSHOLDAWAIT = 400; // ms to wait before press & hold is detected\n  Singleton._PRESSHOLDMARGIN = 25; // pixels that finger might shiver while pressing\n  Singleton._PRESSHOLDTHRESHOLD = 0; // pixels to move before drag starts\n\n  Singleton._rmvAtts = 'id,class,style,draggable'.split(',')\n\n  Singleton._kbdProps = 'altKey,ctrlKey,metaKey,shiftKey'.split(',')\n  Singleton._ptProps = 'pageX,pageY,clientX,clientY,screenX,screenY,offsetX,offsetY'.split(',')\n})(DragDropTouch || (DragDropTouch = {}))\n\nexport default DragDropTouch\n\n"],"names":["DragDropTouch","DragDropTouchExport","DataTransfer","this","_dropEffect","_effectAllowed","_data","Object","defineProperty","prototype","enumerable","configurable","get","set","value","keys","clearData","type","toLowerCase","getData","setData","setDragImage","img","offsetX","offsetY","ddt","DragDropTouchSingleton","_instance","_imgCustom","_imgOffset","x","y","_lastClick","Error","supportsPassive","document","addEventListener","passive","navigator","maxTouchPoints","touchstart","_touchstart","bind","touchmove","_touchmove","touchend","_touchend","Options","capture","getInstance","e","_this","_shouldHandle","Date","now","_DBLCLICK","_dispatchEvent","target","preventDefault","_reset","src_1","_closestDraggable","_dragSource","_ptDown","_getPoint","_lastTouch","setTimeout","_img","_CTXMENU","_ISPRESSHOLDMODE","_pressHoldInterval","_isDragEnabled","_PRESSHOLDAWAIT","_shouldCancelPressHoldMove","_shouldHandleMove","_shouldHandlePressHoldMove","_getTarget","lastPointOnPage","curPointOnPage","_lastMovementX","_lastMovementY","Extras","movementX","movementY","_shouldStartDragging","_createImage","_lastTarget","_moveImage","_isDropZone","_destroyImage","indexOf","defaultPrevented","touches","length","_getDelta","_PRESSHOLDMARGIN","delta","_THRESHOLD","_PRESSHOLDTHRESHOLD","_dataTransfer","clearInterval","page","Touch_1","pageX","clientX","pageY","clientY","Event_1","p","Math","abs","pt","el","elementFromPoint","getComputedStyle","pointerEvents","parentElement","src","cloneNode","_copyStyle","style","top","left","rc","getBoundingClientRect","opacity","_OPACITY","toString","body","appendChild","removeChild","requestAnimationFrame","s","position","zIndex","round","_copyProps","dst","props","i","_rmvAtts","forEach","att","removeAttribute","HTMLCanvasElement","cSrc","cDst","width","height","getContext","drawImage","cs","key","children","evt","createEvent","t","initEvent","_kbdProps","_ptProps","dispatchEvent","hasAttribute","getAttribute","Singleton","split"],"mappings":"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"}